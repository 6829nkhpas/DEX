# ──────────────────────────────────────────────
# Prometheus — Scrape Configuration
# ──────────────────────────────────────────────
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  scrape_timeout: 10s

rule_files:
  - "alert-rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

scrape_configs:
  # ─── Self-monitoring ──────────────────────
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  # ─── Gateway ──────────────────────────────
  - job_name: "gateway"
    metrics_path: /metrics
    scrape_interval: 5s
    static_configs:
      - targets: ["gateway:8080"]
        labels:
          service: gateway
          tier: dmz

  # ─── Matching Engine (hot path — 5s scrape)
  - job_name: "matching-engine"
    metrics_path: /metrics
    scrape_interval: 5s
    static_configs:
      - targets: ["matching-engine:8081"]
        labels:
          service: matching-engine
          tier: internal

  # ─── Market Data ──────────────────────────
  - job_name: "market-data"
    metrics_path: /metrics
    scrape_interval: 10s
    static_configs:
      - targets: ["market-data:8082"]
        labels:
          service: market-data
          tier: internal

  # ─── Risk Engine ──────────────────────────
  - job_name: "risk-engine"
    metrics_path: /metrics
    scrape_interval: 10s
    static_configs:
      - targets: ["risk-engine:8083"]
        labels:
          service: risk-engine
          tier: internal

  # ─── Persistence ──────────────────────────
  - job_name: "persistence"
    metrics_path: /metrics
    scrape_interval: 10s
    static_configs:
      - targets: ["persistence:8084"]
        labels:
          service: persistence
          tier: internal

  # ─── Redis ────────────────────────────────
  - job_name: "redis"
    metrics_path: /metrics
    scrape_interval: 15s
    static_configs:
      - targets: ["redis-exporter:9121"]
        labels:
          service: redis
          tier: infrastructure

  # ─── Loki ─────────────────────────────────
  - job_name: "loki"
    static_configs:
      - targets: ["loki:3100"]
        labels:
          service: loki
          tier: monitoring
