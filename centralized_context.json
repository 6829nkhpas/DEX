{
  "project": {
    "name": "DEX",
    "description": "Distributed Exchange",
    "repo": "https://github.com/6829nkhpas/DEX",
    "spec_version": "1.0.0"
  },
  "apis": [
    {
      "service": "Order Service",
      "path": "/v1/orders",
      "method": "POST",
      "request_schema": "CreateOrderRequest",
      "response_schema": "OrderResponse",
      "auth": true,
      "examples": {
        "request": {
          "account_id": "01939d7f-8e4a-7890-a123-456789abcdef",
          "symbol": "BTC/USDT",
          "side": "BUY",
          "price": "50000.00",
          "quantity": "1.0",
          "time_in_force": { "type": "GTC" }
        },
        "response": {
          "order_id": "123e4567-e89b-12d3-a456-426614174000",
          "status": "PENDING"
        }
      }
    },
    {
      "service": "Order Service",
      "path": "/v1/orders/:id",
      "method": "DELETE",
      "request_schema": "CancelOrderRequest",
      "response_schema": "None",
      "auth": true,
      "examples": {
        "request": {
          "account_id": "01939d7f-8e4a-7890-a123-456789abcdef"
        }
      }
    },
    {
      "service": "Order Service",
      "path": "/v1/orders/:id",
      "method": "GET",
      "request_schema": "None",
      "response_schema": "Order",
      "auth": true,
      "examples": {
        "response": {
          "order_id": "1234",
          "account_id": "1234",
          "symbol": "BTC/USDT",
          "side": "BUY",
          "price": "50000.00",
          "quantity": "1.0",
          "filled_quantity": "0.0",
          "remaining_quantity": "1.0",
          "status": { "state": "PENDING" },
          "time_in_force": { "type": "GTC" },
          "created_at": "1708123456789000000",
          "updated_at": "1708123456789000000",
          "version": 0
        }
      }
    },
    {
      "service": "Account Service",
      "path": "/v1/accounts/:id",
      "method": "GET",
      "request_schema": "None",
      "response_schema": "Account",
      "auth": true,
      "examples": {
        "response": {
          "account_id": "1234",
          "balances": {
            "BTC": "1.0"
          }
        }
      }
    }
  ],
  "websockets": [
    {
      "channel": "market_data",
      "direction": "server",
      "message_schema": "MarketDataUpdated",
      "examples": {
        "snapshot": {
          "event_id": "evt-idx-1000",
          "event_type": "MarketDataSnapshot",
          "sequence": "1000",
          "timestamp": "1708123456789000000",
          "source": "MarketDataService",
          "payload": { "symbol": "BTC/USDT", "bids": [], "asks": [] },
          "metadata": {
            "version": "1.0",
            "correlation_id": "uuid-corr",
            "causation_id": "uuid-cause"
          }
        },
        "delta": {
          "event_id": "evt-idx-1001",
          "event_type": "MarketDataUpdated",
          "sequence": "1001",
          "timestamp": "1708123456789000000",
          "source": "MarketDataService",
          "payload": {
            "symbol": "BTC/USDT",
            "last_price": "50000.00",
            "volume_24h": "1234.56",
            "high_24h": "51000.00",
            "low_24h": "49000.00",
            "mark_price": "50010.00"
          },
          "metadata": {
            "version": "1.0",
            "correlation_id": "uuid-corr",
            "causation_id": "uuid-cause"
          }
        }
      }
    }
  ],
  "types": {
    "Price": {
      "fields": { "value": "string" },
      "serialization": "string representing decimal",
      "examples": ["50000.00"]
    },
    "Quantity": {
      "fields": { "value": "string" },
      "serialization": "string representing decimal",
      "examples": ["1.0"]
    },
    "Timestamp": {
      "fields": { "value": "string" },
      "serialization": "string representing Unix nanoseconds (i64)",
      "examples": ["1708123456789000000"]
    },
    "OrderStatus": {
      "fields": { "state": "string", "reason": "string (optional)" },
      "serialization": "JSON object with state tag",
      "examples": [{ "state": "PENDING" }, { "state": "CANCELED", "reason": "USER_REQUESTED" }]
    },
    "TimeInForce": {
      "fields": { "type": "string", "value": "string (optional, Unix nanos)" },
      "serialization": "JSON object with type tag",
      "examples": [{ "type": "GTC" }, { "type": "GTD", "value": "1708123456789000000" }]
    },
    "Order": {
      "fields": {
        "order_id": "string",
        "account_id": "string",
        "symbol": "string",
        "side": "string",
        "price": "Price",
        "quantity": "Quantity",
        "filled_quantity": "Quantity",
        "remaining_quantity": "Quantity",
        "status": "OrderStatus",
        "time_in_force": "TimeInForce",
        "created_at": "Timestamp",
        "updated_at": "Timestamp",
        "version": "integer"
      },
      "serialization": "JSON object",
      "examples": [{
        "order_id": "123e4567-e89b-12d3-a456-426614174000",
        "account_id": "01939d7f-8e4a-7890-a123-456789abcdef",
        "symbol": "BTC/USDT",
        "side": "BUY",
        "price": "50000.00",
        "quantity": "1.0",
        "filled_quantity": "0.3",
        "remaining_quantity": "0.7",
        "status": { "state": "PARTIAL" },
        "time_in_force": { "type": "GTC" },
        "created_at": "1708123456789000000",
        "updated_at": "1708123456790000000",
        "version": 1
      }]
    },
    "MarketData": {
      "fields": {
        "symbol": "string",
        "last_price": "Price",
        "volume_24h": "Quantity",
        "high_24h": "Price",
        "low_24h": "Price",
        "mark_price": "Price"
      },
      "serialization": "JSON object",
      "examples": [{
        "symbol": "BTC/USDT",
        "last_price": "50000.00",
        "volume_24h": "1234.56",
        "high_24h": "51000.00",
        "low_24h": "49000.00",
        "mark_price": "50010.00"
      }]
    }
  },
  "contracts": {
    "Vault": {
      "abi_path": "chain/contracts/abi/vault.json",
      "read_methods": [
        "is_whitelisted",
        "get_balance",
        "get_account_balances",
        "is_paused",
        "admin",
        "events"
      ],
      "write_methods": [
        "add_to_whitelist",
        "remove_from_whitelist",
        "deposit",
        "confirm_deposit",
        "safe_debit",
        "pause",
        "unpause",
        "set_admin",
        "drain_events"
      ],
      "notes": "15 methods. ABI hand-authored from Rust source (no WASM bindings)."
    },
    "WithdrawalQueue": {
      "abi_path": "chain/contracts/abi/withdrawal.json",
      "read_methods": [
        "queue",
        "events"
      ],
      "write_methods": [
        "request_withdrawal",
        "process_withdrawal",
        "batch_withdraw",
        "cancel_withdrawal",
        "drain_events"
      ],
      "notes": "Manages withdrawal lifecycle: request → queue → delay → process → complete."
    },
    "CommitmentStore": {
      "abi_path": "chain/contracts/abi/commitment.json",
      "read_methods": [
        "get_latest_root",
        "history",
        "disputes",
        "events"
      ],
      "write_methods": [
        "submit_root",
        "raise_dispute",
        "resolve_dispute",
        "admin_override",
        "grant_operator",
        "drain_events"
      ],
      "notes": "State commitment + fraud proof layer."
    }
  },
  "events": [
    {
      "name": "OrderSubmitted",
      "source_service": "OrderService",
      "schema": { "order_id": "string", "account_id": "string", "symbol": "string", "side": "string", "type": "string", "price": "string", "quantity": "string", "time_in_force": "string" },
      "example": {
        "event_id": "evt-uuid",
        "event_type": "OrderSubmitted",
        "sequence": "1",
        "timestamp": "1708123456789000000",
        "source": "OrderService",
        "payload": { "order_id": "uuid", "account_id": "uuid", "symbol": "BTC/USDT", "side": "BUY", "type": "LIMIT", "price": "50000.00", "quantity": "1.0", "time_in_force": "GTC" },
        "metadata": { "version": "1.0", "correlation_id": "uuid-corr", "causation_id": "uuid-cause" }
      },
      "seq_rules": "Strictly monotonic sequence number per event."
    },
    {
      "name": "MarketDataUpdated",
      "source_service": "MarketDataService",
      "schema": { "symbol": "string", "last_price": "string", "volume_24h": "string", "high_24h": "string", "low_24h": "string", "mark_price": "string" },
      "example": {
        "event_id": "evt-uuid-2",
        "event_type": "MarketDataUpdated",
        "sequence": "1001",
        "timestamp": "1708123456789000000",
        "source": "MarketDataService",
        "payload": { "symbol": "BTC/USDT", "last_price": "50000.00", "volume_24h": "1234.56", "high_24h": "51000.00", "low_24h": "49000.00", "mark_price": "50010.00" },
        "metadata": { "version": "1.0", "correlation_id": "uuid-corr", "causation_id": "uuid-cause" }
      },
      "seq_rules": "Symbol sequence number."
    }
  ],
  "services": {
    "API Gateway": {
      "owner_dir": "/services/gateway",
      "inputs": ["HTTP Requests", "WebSockets"],
      "outputs": ["gRPC downstream calls"],
      "dependencies": ["Order Service", "Account Service"]
    },
    "Order Service": {
      "owner_dir": "/services/order",
      "inputs": ["gRPC CreateOrder"],
      "outputs": ["Order Events"],
      "dependencies": ["Account Service", "Risk Service", "Matching Engine"]
    }
  },
  "errors": [
    {
      "code": "INSUFFICIENT_BALANCE",
      "message": "Available balance too low",
      "http_status": 400,
      "service": "Account Service"
    }
  ],
  "versioning": {
    "spec_version": "1.0.0",
    "schema_versioning_strategy": "Backward compatible additions only. Breaking changes require new major version.",
    "migration_notes": "v1.0.1: Timestamps changed from integer to string-encoded Unix nanos. Market data keys renamed (24h_* → *_24h)."
  },
  "constraints": {
    "numeric_precision": "18 decimal places internally. Use Decimal fixed-point type serialized to string JSON.",
    "timestamp_format": "Unix nanoseconds as string (i64 encoded as JSON string to prevent precision loss)",
    "sequence_rules": "No gaps. Strictly increasing.",
    "determinism_rules": "Same inputs -> Same outputs. No floating defaults. Monotonic clocks."
  }
}
